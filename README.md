# Anime Watch History Tracker

## 项目概述
https://www.295k.cc/
这是一个 Chrome 扩展，用于跟踪用户观看的动漫集数。该扩展可以在用户观看动漫时自动保存观看历史，并在页面加载时显示当前集数。

## 简介
这是一个用于管理观看历史的应用程序，支持查询和清除记录。

## 功能
- 保存观看历史: 在用户观看动漫时，自动保存标题、URL、集数和时间戳。
- 使用 IndexedDB: 采用 IndexedDB 存储观看历史数据，支持离线访问。
- 页面加载时显示当前集数: 在加载页面时，显示当前观看的动漫集数。
- 查询观看历史记录
- 清空所有记录
- 按时间倒序排列记录

## 文件结构
```
d:/temp/player/
├── Database.js      // 数据库相关操作
├── History.js       // 观看历史相关操作
├── WatchHistory.js   // 观看历史记录类
└── content.js       // 主逻辑
```

## 使用说明
1. 打开应用程序。
2. 输入查询条件以搜索观看历史。
3. 点击清空按钮以删除所有记录。
4. 打开支持的动漫页面，扩展将自动记录观看历史。
5. 点击扩展图标查看当前观看的集数。

## 查看数据库的方法
由于 Chrome 插件的限制，有时无法通过常规的方式（如从 Service Worker 定位到控制台）查看 IndexedDB 数据库。这可能是 Chrome 的一个已知问题，尤其是在插件环境中。以下是推荐的查看方法：

1. **通过 1st-party 页面访问数据库：**
   - 打开扩展程序操作的页面（即支持记录的动漫页面）。
   - 按 `F12` 或右键选择“检查”打开开发者工具。
   - 进入“控制台”标签页，手动输入以下代码以查看数据库内容：
     ```javascript
     const request = indexedDB.open('你的数据库名称');
     request.onsuccess = function(event) {
         const db = event.target.result;
         const transaction = db.transaction(['你的对象存储名称'], 'readonly');
         const store = transaction.objectStore('你的对象存储名称');
         const allRecords = store.getAll();
         allRecords.onsuccess = function() {
             console.log(allRecords.result);
         };
     };
     request.onerror = function(event) {
         console.error('无法打开数据库:', event.target.errorCode);
     };
     ```
   - 替换 `你的数据库名称` 和 `你的对象存储名称` 为实际使用的名称。

2. **避免使用 Application 标签页：**
   - 在某些情况下，直接从 DevTools 的“Application”标签页查看 IndexedDB 数据可能会显示为空。这是由于 Chrome 插件环境的特殊性，建议使用控制台代码直接查询。

3. **日志调试：**
   - 在 `Database.js` 中添加日志输出代码，确保数据库操作过程中的每一步都能记录。
   - 示例：
     ```javascript
     console.log('Opening IndexedDB:', dbName);
     ```

## 安装
1. 下载或克隆此项目。
2. 打开 Chrome 浏览器，访问 `chrome://extensions/`。
3. 启用“开发者模式”。
4. 点击“加载已解压的扩展程序”，选择项目文件夹。
5. 扩展程序将被加载并可使用。

## 改进建议
1. **功能增强：**
   - **多设备同步：** 集成 Chrome 的 `chrome.storage.sync` 或其他云同步服务，让用户可以在不同设备之间共享观看历史。
   - **观看提醒：** 提醒用户未完成的动漫，提升用户体验。
   - **标记完成：** 允许用户标记某部动漫为已完成，方便管理观看列表。
   - **自定义标签：** 用户可以为每部动漫添加标签或备注，如“喜欢”、“不喜欢”等。

2. **用户体验优化：**
   - **UI 界面：** 设计一个简洁美观的界面，让用户直观地查看和管理观看历史。
   - **快捷键支持：** 增加快捷键，比如快速打开扩展或标记当前集数。
   - **通知功能：** 当用户访问已观看过的页面时，弹出通知显示上次观看的集数。

3. **性能改进：**
   - **数据压缩：** 对观看历史较多的用户，考虑对数据进行压缩存储。
   - **异步优化：** 确保 IndexedDB 操作是非阻塞的，以提升页面加载性能。

4. **文件结构改进：**
   - **模块化设计：** 将功能进一步模块化，比如分离 UI 操作和数据库操作。
   - **新增配置文件：** 例如 `config.js`，存储全局配置选项，如数据库名称、版本等。

5. **测试与调试：**
   - **单元测试：** 为核心功能编写单元测试，确保代码的可靠性。
   - **日志记录：** 添加日志功能，方便用户和开发者调试问题。

6. **安全性改进：**
   - **数据加密：** 如果用户的数据包含敏感信息，可以对数据进行加密存储。
   - **权限最小化：** 确保扩展只申请必要的权限。

## 贡献
欢迎任何形式的贡献！请提交问题或拉取请求。

## 许可证
本项目采用 MIT 许可证。

